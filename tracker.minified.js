// --- created by Sokol815 1/17/2018
// --- version 1.2.4.0
// --- if you like this, consider tipping me! LTC: LNpicahdGTFpuXNEhTVoUErPb6EEjBdmwg
!function(){var t={graphMinutes:15,extendGraphColumn:!0,drawZeroLine:!0,drawSellThreshold:!0,zeroLineColor:"#333",sellThresholdColor:"#ff5",graphLineColor:"#00f",topOffsetPercentage:2,bottomOffsetPercentage:2,testHangWarning:!0,hangThreshold:10,percentHanging:.5,hangWarningMessage:"{n} Prices seem to be stagnant... did the bot hang?",displayMarketCap:!0,coinMarketCapAPI:"https://api.coinmarketcap.com/v1/global/",msPerDataFrame:12900};t.topOffsetPercentage=Math.min(60,Math.max(2,t.topOffsetPercentage)),t.bottomOffsetPercentage=Math.min(60,Math.max(2,t.bottomOffsetPercentage)),t.graphFrames=6*(t.graphMinutes||5)>>0,t.hangThreshold=Math.min(999,Math.max(1,t.hangThreshold)),t.percentHanging=Math.min(1,Math.max(.001,t.percentHanging)),t.createHiDPICanvas=function(t,a,e,i){var n;window.PIXEL_RATIO||(window.PIXEL_RATIO=(n=document.createElement("canvas").getContext("2d"),(window.devicePixelRatio||1)/(n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1))),e||(e=window.PIXEL_RATIO);var s=Array.isArray(i)?i[0]:i;return s.width=t*e,s.height=a*e,s.style.width=t+"px",s.style.height=a+"px",s.getContext("2d").setTransform(e,0,0,e,0,0),s},t.graph=function(a,e){this.stats={totalSamples:t.graphFrames,profitLine:.01,data:[]},this.stats.data=new Array(this.stats.totalSamples),this.stats.data=this.stats.data.join(",").split(",").map(function(){return null}),this.drawZero=a,this.drawProfit=e},t.graph.prototype.setSelector=function(a){this.destination=a[0];var e=a.width(),i=a.height();if((n=$("#myCanvas")).length<1){$("body").append('<div style="position:absolute;display:none;"><canvas id="myCanvas"></canvas></div>');var n=$("#myCanvas");n=t.createHiDPICanvas(e,i,1,n[0]),t.canvas=n,t.canvasContext=n.getContext("2d")}this.canvas=n},t.graph.prototype.updateStats=function(t,a){this.stats.data.push(t),this.stats.profitLine=a,this.stats.data.shift()},t.graph.prototype.drawStats=function(){var a=t.canvasContext,e=this.destination.getBoundingClientRect(),i=this.stats.totalSamples;if(t.extendGraphColumn&&e.width<i&&(this.destination.style.width=i+"px",e.width=i),void 0!=t.canvas&&void 0!=t.canvas.height){e.width==t.canvas.width&&e.height==t.canvas.height||(t.canvas=t.createHiDPICanvas(e.width,e.height,1,$("#myCanvas")[0]),t.canvasContext=t.canvas.getContext("2d")),a.clearRect(0,0,e.width,e.height);var n=!0,s={min:1e8,max:-1e8,size:0};if(this.stats.data.forEach(function(t){null!==t&&(s.min=Math.min(t,s.min),s.max=Math.max(t,s.max))}),this.drawZero&&(s.min=Math.min(s.min,0),s.max=Math.max(s.max,0)),this.drawProfit&&(s.max=Math.max(s.max,this.stats.profitLine),s.min=Math.min(s.min,this.stats.profitLine)),s.size=s.max-s.min,s.max+=s.size*(t.topOffsetPercentage/100),s.min-=s.size*(t.bottomOffsetPercentage/100),s.size=s.max-s.min,t.drawZeroLine&&this.drawZero){var r=Math.abs(s.max-0)/s.size;a.strokeStyle=t.zeroLineColor,a.fillStyle=t.zeroLineColor,a.lineWidth=1,a.font="12px calibri",a.fillText("0%",0,.5+(r*e.height>>0)),a.beginPath(),a.moveTo(20,.5+(r*e.height>>0)),a.lineTo(e.width,.5+(r*e.height>>0)),a.stroke()}if(t.drawSellThreshold&&this.drawProfit){r=Math.abs(s.max-this.stats.profitLine)/s.size;a.strokeStyle=t.sellThresholdColor,a.lineWidth=1,a.beginPath(),a.moveTo(0,.5+(r*e.height>>0)),a.lineTo(e.width,.5+(r*e.height>>0)),a.stroke()}a.strokeStyle=t.graphLineColor,a.lineWidth=1,a.beginPath();n=!0;for(var o=0,h=0;h<i;h++)null!=this.stats.data[h]&&""!=this.stats.data[h]&&(n?(n=!1,a.moveTo(o/i*e.width,e.height-(this.stats.data[h]-s.min)/s.size*e.height)):a.lineTo(o/i*e.width,e.height-(this.stats.data[h]-s.min)/s.size*e.height),o++);a.stroke();var l="url("+t.canvas.toDataURL()+")";this.destination.style.backgroundImage=l,this.destination.style.backgroundRepeat="no-repeat"}};var a,e,i,n={dca:{dataName:"dcaLogData",name:"dtDcaLogs",statName:"profit",childDestination:"profit",drawZero:!0,drawProfit:!0,hangCheck:!0,pairAppend:""},pairs:{dataName:"gainLogData",name:"dtPairsLogs",statName:"profit",childDestination:"profit",drawZero:!0,drawProfit:!0,hangCheck:!0,pairAppend:""},pbl:{dataName:"bbBuyLogData",name:"dtPossibleBuysLog",statName:"currentValue",childDestination:"current-value",drawZero:!1,drawProfit:!1,hangCheck:!0,pairAppend:"_PBL"},dust:{dataName:"dustLogData",name:"dtDustLogs",statName:"profit",childDestination:"profit",drawZero:!0,drawProfit:!1,hangCheck:!1,pairAppend:"_DUST"},pending:{dataName:"pendingLogData",name:"dtPendingLogs",statName:"profit",childDestination:"profit",drawZero:!0,drawProfit:!0,hangCheck:!1,pairAppend:"_PEND"}},s={},r=6e4;function o(a){t.displayMarketCap&&$.get(t.coinMarketCapAPI,function(t){if(t&&t.total_market_cap_usd){var a=t.total_market_cap_usd.toLocaleString("en",{useGrouping:!0}),e=$("#nMCAPTotal");e.length?e.attr("title",a).html(a):$(".monitor-summary").append('<li class="list-inline-item tdbitcoin font-16 ticker-text"><label id="nMCAP" data-toggle="tooltip" data-placement="bottom" title="Total Crypto MarketCap" data-original-title="Total Crypto MarketCap">MCAP</label>: <span id="nMCAPTotal" title="'+a+'">'+a+"</span></li>")}});for(var e=Date.now(),i={signaled:0,max:0},o=Object.keys(s),l=0;l<o.length;l++)e-s[o[l]].lastTick>r&&delete s[o[l]];var p=Object.keys(n);for(l=0;l<p.length;l++)for(var c=a[n[p[l]].dataName],m=0;m<c.length;m++){var f=c[m].market+n[p[l]].pairAppend;if(void 0==s[f]){s[f]={lastTick:e,graph:new t.graph(n[p[l]].drawZero,n[p[l]].drawProfit)};for(var u=g(f),v=0;v<u.length;v++)s[f].graph.updateStats(u[v],0)}else s[f].lastTick=e;if(s[f].graph.updateStats(c[m][n[p[l]].statName]/100,(c[m].triggerValue||0)/100),d(f,s[f].graph.stats.data,s[f].lastTick),t.testHangWarning&&n[p[l]].hangCheck)i.max++,h(s[f])>=t.hangThreshold&&(console.log(f+" is signaling a hang."),i.signaled++)}t.testHangWarning&&i.max>0&&i.signaled/i.max>=t.percentHanging&&alert(t.hangWarningMessage.replace("{n}",i.signaled))}function h(t){t.graph.stats.totalSamples;for(var a=null,e=0,i=t.graph.stats.totalSamples-1;i>-1;i--){var n=t.graph.stats.data[i];if(null!=n&&""!=n&&null==a)a=n,e++;else if(n==a)e++;else if(null!=a)return e}return 0}function l(){for(var t=Object.keys(n),a=0;a<t.length;a++){var e=n[t[a]];if(100!=(i=$("#"+e.name)).width()){for(var i=$("#"+e.name+" tbody tr"),r=0;r<i.length;r++){var o=$(i[r]).children(".market").children("a").html(),h=s[o+e.pairAppend];void 0!==h&&(h.graph.setSelector($(i[r]).children("."+e.childDestination)),h.graph.drawStats())}return}}}function d(t,a,e){var i=localStorage.getItem("graphing");i=null==i?{}:JSON.parse(i);for(var n=[],s=0;s<a.length;s++)null==a[s]||""==a[s]||n.push(parseFloat(a[s].toFixed(4)));i[t]={time:e,values:n},localStorage.setItem("graphing",JSON.stringify(i))}function g(a){var e=localStorage.getItem("graphing");if(void 0!=(e=null==e?{}:JSON.parse(e))[a]){for(var i=(Date.now()-e[a].time)/t.msPerDataFrame>>0,n=e[a].values,s=0;s<i;s++)n.push(null);return n}return[]}a=function(t){t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(t.responseURL.indexOf("data")>-1&&o(JSON.parse(t.response)))}},XMLHttpRequest.callbacks?XMLHttpRequest.callbacks.push(a):(XMLHttpRequest.callbacks=[a],e=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.send=function(){for(i=0;i<XMLHttpRequest.callbacks.length;i++)XMLHttpRequest.callbacks[i](this);e.apply(this,arguments)}),$("body").on("DOMSubtreeModified","#dvLastUpdatedOn",function(){l()}),$(".dca-log,.dust-log,.pairs-log,.possible-buys-log,.pending-log").on("click",function(){setTimeout(function(){l()},100)})}();